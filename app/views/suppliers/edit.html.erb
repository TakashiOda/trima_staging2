<script src="https://yubinbango.github.io/yubinbango/yubinbango.js" charset="UTF-8"></script>
<%= form_for @supplier, html: { class: "h-adr" } do |form| %>
<div class="form_title">
  <h3>契約者情報を編集</h3>
</div>
<%= render 'layouts/error_messages', model: form.object %>
<div class="user_show_content_down">
  <div class="user_show_info_items_box">
    <section class="form_section">
      <div class="form-group">
        <%= form.label :name %>
        <%= form.text_field :name, required: true, class: "form-control", oninput: 'hasInput()' %>
      </div>
      <%= form.fields_for :supplier_profile do |pf| %>
        <div class="form-group">
          <%= pf.label :representative_name %>
          <%= pf.text_field :representative_name, required: true, maxlength: 30, class: "form-control", oninput: 'hasInput()' %>
        </div>
        <div class="form-group">
          <%= pf.label :representative_kana %>
          <%= pf.text_field :representative_kana, required: true, maxlength: 30, class: "form-control", oninput: 'hasInput()' %>
        </div>
        <div class="form-group">
          <%= pf.label :manager_name %>
          <%= pf.label :※代表者様以外にご担当者がいらっしゃる場合にご入力ください, class: 'form_label_hosoku' %>
          <%= pf.text_field :manager_name, maxlength: 30, class: "form-control", oninput: 'hasInput()' %>
        </div>
        <div class="form-group">
          <%= pf.label :manager_name_kana %>
          <%= pf.text_field :manager_name_kana, maxlength: 30, class: "form-control", oninput: 'hasInput()' %>
        </div>
        <div class="form-group">
          <%= pf.label :post_code %>
          <div class="post_code_box">
            <span>〒</span>
            <!-- <input class="p-postal-code form-control" type="text" id="post_code_input3" size="7" maxlength="7" oninput="post_code3()"> -->
            <input
              class="p-postal-code form-control"
              type="text"
              id="post_code_input3"
              size="7"
              maxlength="7"
              oninput="post_code3()"
              value="<%= @supplier.supplier_profile.post_code if !@supplier.supplier_profile.nil? && !@supplier.supplier_profile.post_code.nil? %>"
            >
            <!-- <input
              class="p-postal-code form-control"
              type="text"
              id="post_code_input3"
              size="3"
              maxlength="3"
              oninput="post_code3()"
              value="<%#= @supplier.supplier_profile.post_code[0, 3] if !@supplier.supplier_profile.nil? && !@supplier.supplier_profile.post_code.nil? %>"
            >
            <span>-</span>
            <input
              class="p-postal-code form-control"
              type="text"
              id="post_code_input4"
              size="4"
              maxlength="4"
              oninput="post_code4()"
              value="<%#= @supplier.supplier_profile.post_code[3, 4] if !@supplier.supplier_profile.nil? && !@supplier.supplier_profile.post_code.nil?%>"
            > -->
          </div>
          <%= pf.hidden_field :post_code, id: 'hidden_post_code' %>
        </div>
        <div class="form-group">
          <span class="p-country-name" style="display:none;">Japan</span>
          <%= pf.label :prefecture %>
          <%= pf.text_field :prefecture, class: "p-region form-control", oninput: 'hasInput()', onchange: 'prefectureChange()' %>
        </div>
        <div class="form-group">
          <%= pf.label :town %>
          <%= pf.text_field :town, class: "p-locality form-control", oninput: 'hasInput()' %>
        </div>
        <div class="form-group">
          <%= pf.label :detail_address %>
          <%= pf.text_field :detail_address, minlength: 3, maxlength: 100, class: "p-street-address p-extended-address form-control", oninput: 'hasInput()' %>
        </div>
        <div class="form-group">
          <%= pf.label :building %>
          <%= pf.text_field :building, maxlength: 100, class: "form-control", oninput: 'hasInput()' %>
        </div>
        <div class="form-group">
          <%= pf.label :phone %>
          <%= pf.text_field :phone, minlength: 10, maxlength: 11, required: true, class: "form-control", oninput: 'hasInput()' %>
        </div>
      <% end %>
    </section>
  </div>
  <div class="user_show_info_button_box">
    <div class="form_sidebtns_container">
      <div class="form_sidebtns">
        <div class="form_sidebtn">
          <%= link_to "キャンセル", supplier_path(current_supplier), class: "button btn-cansel" %>
        </div>
        <div class="form_sidebtn">
          <%= form.submit('更新する',class: 'button btn-submit', id: "supplier_form_submit_btn") %>
        </div>
      </div>
    </div>
  </div>
</div>
<% end %>

<script>
  function hasInput() {
    const submitBtn = document.getElementById('supplier_form_submit_btn');
    submitBtn.classList.add('need_submit');
  }

  const selectElement = document.querySelector('#post_image');
  function image_input_btn() {
    selectElement.click();
  }
  // function fullFillPostCode() {
  //   const code3 = document.querySelector('#post_code_input3').value;
  //   const code4 = document.querySelector('#post_code_input4').value;
  //   const fullCode = code3 + code4;
  //   console.log(code3);
  //   console.log(code4);
  //   console.log(fullCode);
  //   const hiddenPostCode = document.querySelector('#hidden_post_code');
  //   hiddenPostCode.value = fullCode;
  // }
  function post_code3() {
    const code3 = document.querySelector('#post_code_input3').value;
    // const code4 = document.querySelector('#post_code_input4').value;
    // const fullCode = code3 + code4;
    const hiddenPostCode = document.querySelector('#hidden_post_code');
    hiddenPostCode.value = code3;
    // if (code3.length == 3) {
    //   document.getElementById('post_code_input4').focus();
    // }
  }
  // function post_code4() {
  //   const code3 = document.querySelector('#post_code_input3').value;
  //   const code4 = document.querySelector('#post_code_input4').value;
  //   const fullCode = code3 + code4;
  //   const hiddenPostCode = document.querySelector('#hidden_post_code');
  //   hiddenPostCode.value = fullCode;
  // }
  function prefectureChange(obj) {
    // const code3 = document.querySelector('#post_code_input3').value;
    // const code4 = document.querySelector('#post_code_input4').value;
    // const fullCode = code3 + code4;
    console.log(obj);
    // const hiddenPostCode = document.querySelector('#hidden_post_code');
    // hiddenPostCode.value = fullCode;
  }

  // document.getElementById('post_image').addEventListener('change', function (e) {
  //   const file = e.target.files[0];
  //   const blobUrl = window.URL.createObjectURL(file);
  //   const post_img = document.getElementById('user_image_prev');
  //   post_img.src = blobUrl;
  //   post_img.classList.toggle("hidden");
  //   const before_img = document.getElementById('user_present_image');
  //   before_img.classList.toggle("hidden");
  // });

  function hasChangeArea(obj) {
    const townSelectors = document.querySelectorAll("div.town_select");
    for (var i = 0; i < townSelectors.length; i++) {
      const townSelectItem = townSelectors[i];
      townSelectItem.classList.add('hidden');
    }

    const selectedAreaNum = obj.value;
    const targetId = `area_${selectedAreaNum}`;
    const targetTownSelectBox = document.getElementById(`${targetId}`);
    targetTownSelectBox.classList.remove('hidden');
  }

  function hasSelectTown(obj) {
    const targetTownSelectBox = document.getElementById('hidden_town_field');
    targetTownSelectBox.value = obj.value;
  }
</script>

<style lang="scss">
  #user_edit_image_upload_btn:hover {
    cursor: pointer;
  }
  .hidden {
    display: none;
  }

  .form-group.manage_agent_input_box {
    display: flex;
    flex-wrap: wrap;
  }
  .form-group.manage_agent_input_box .form-group {
    display: flex;
    align-items: center;
    margin-bottom: 5px;
    width: 46%;
  }
  .form-group.manage_agent_input_box input[type=checkbox] {
    width: 25px;
    height: 30px;
  }
  label.form_label_hosoku {
    font-size: 10px;
    font-weight: unset;
    color: #a7a7a7;
  }
  div.town_select select {
    width: 100%;
  }
</style>
